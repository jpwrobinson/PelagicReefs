"use strict";(self.webpackChunkinvenio_assets=self.webpackChunkinvenio_assets||[]).push([[9300],{9300:(e,t,n)=>{n.d(t,{w:()=>Se});var r=n(80296),a=n(96540),o=n(93682),s=n(3487),i=n(76217),l=n(23029),c=n(92901),u=n(56822),d=n(53954),p=n(85501),m=n(64467),f=n(25633),v=n(28085),h=n(98591),A=n(27089),g=n(48423),E=n(70742),y=n(5556),b=n.n(y),k=n(10467),w=n(54756),C=n.n(w),x=n(28930),R=n(81057),M=n(45458),O=n(62193),S=n.n(O),_=n(87395),q=n(53959),N=n(1489),D=n(92257),T=n(34667);function P(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(P=function(){return!!e})()}var j=function(e){function t(e){var n,r,a,o;(0,l.A)(this,t),r=this,a=t,o=[e],a=(0,d.A)(a);var s=(n=(0,u.A)(r,P()?Reflect.construct(a,o||[],(0,d.A)(r).constructor):a.apply(r,o))).props.record,i=(null===s||void 0===s?void 0:s.is_draft)||null===(null===s||void 0===s?void 0:s.is_draft);return n.state={description:void 0,expiresAt:void 0,permission:i?$[1].key:$[0].key},n}return(0,p.A)(t,e),(0,c.A)(t,[{key:"render",value:function(){var e=this,t=this.state,n=t.permission,r=t.expiresAt,o=t.description,l=this.props,c=l.handleCreation,u=l.loading,d=l.dropdownOptions;return a.createElement(q.A.Row,null,a.createElement(q.A.Cell,{width:16},a.createElement(N.A,null,a.createElement(N.A.Column,{width:4},a.createElement(D.A,{id:"access-request-description",onChange:function(t,n){return e.setState({description:n.value})},fluid:!0}),a.createElement("label",{htmlFor:"access-request-description",className:"helptext mb-0 mt-10"},E.M.t("Short name for your link (optional)."))),a.createElement(N.A.Column,{width:4},a.createElement(D.A,{id:"access-request-expires-at",onChange:function(t,n){e.setState({expiresAt:n.value})},fluid:!0,placeholder:E.M.t("Expiration date format: YYYY-MM-DD")}),a.createElement("label",{htmlFor:"access-request-expires-at",className:"helptext mb-0 mt-10"},E.M.t("Expiration date: YYYY-MM-DD or never if blank (optional)."))),a.createElement(N.A.Column,{width:4},a.createElement(T.A,{placeholder:E.M.t("Select permissions"),fluid:!0,selection:!0,onChange:function(t,n){return e.setState({permission:n.value})},options:d,defaultValue:n})),a.createElement(N.A.Column,{width:4,textAlign:"right"},a.createElement(s.A,{onClick:function(){return c(n,r,o)},icon:!0,loading:u,disabled:u,labelPosition:"left",positive:!0},a.createElement(i.A,{name:"code branch"}),E.M.t("Create a new link"))))))}}])}(a.Component);j.propTypes={handleCreation:b().func.isRequired,loading:b().bool.isRequired,dropdownOptions:b().array.isRequired,record:b().object.isRequired};var U=n(38992),B=n(69521);function G(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(G=function(){return!!e})()}var I=function(e){var t;return(null===e||void 0===e||null===(t=e.response)||void 0===t||null===(t=t.data)||void 0===t?void 0:t.message)||(null===e||void 0===e?void 0:e.message)},F=function(e){function t(e){var n,r,a,o;return(0,l.A)(this,t),r=this,a=t,o=[e],a=(0,d.A)(a),n=(0,u.A)(r,G()?Reflect.construct(a,o||[],(0,d.A)(r).constructor):a.apply(r,o)),(0,m.A)(n,"onSuccess",(function(){return n.setState({loading:!1,actionSuccess:!0,error:void 0})})),(0,m.A)(n,"handleUpdate",function(){var e=(0,k.A)(C().mark((function e(t){var r,a,o,s,i,l,c,u;return C().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=n.props,a=r.updateEndpoint,o=r.onPermissionChanged,s=r.result,i=r.entityType,l={permission:t},n.setState({loading:!0,actionSuccess:!1}),n.cancellableAction=(0,R.withCancel)(R.http.patch(a,l)),e.prev=4,e.next=7,Promise.all([new Promise((function(e){return setTimeout(e,400)})),n.cancellableAction.promise]);case 7:n.onSuccess(),o(null!==(c=null===s||void 0===s||null===(u=s.subject)||void 0===u?void 0:u.id)&&void 0!==c?c:s.id,l.permission,i),e.next=17;break;case 11:if(e.prev=11,e.t0=e.catch(4),"UNMOUNTED"!==e.t0){e.next=15;break}return e.abrupt("return");case 15:n.setState({loading:!1,actionSuccess:!1,error:I(e.t0)}),console.error(e.t0);case 17:case"end":return e.stop()}}),e,null,[[4,11]])})));return function(t){return e.apply(this,arguments)}}()),n.state={error:void 0,loading:!1,actionSuccess:void 0},n}return(0,p.A)(t,e),(0,c.A)(t,[{key:"componentWillUnmount",value:function(){this.cancellableAction&&this.cancellableAction.cancel()}},{key:"render",value:function(){var e=this,t=this.props,n=t.result,r=t.dropdownOptions,o=this.state,s=o.loading,i=o.actionSuccess,l=o.error;return a.createElement("div",{className:"flex align-items-center access-dropdown-container"},a.createElement(T.A,{className:"overflow-scroll",placeholder:E.M.t("Select permissions"),fluid:!0,loading:s,selection:!0,options:r,onChange:function(t,n){return e.handleUpdate(n.value)},defaultValue:n.permission}),a.createElement("div",{className:"ml-5 action-status-container"},i&&a.createElement(B.BK,{timeOutDelay:3e3,show:i}),l&&a.createElement(B.rt,{error:l})))}}])}(a.Component);F.propTypes={result:b().object.isRequired,dropdownOptions:b().array.isRequired,updateEndpoint:b().string.isRequired,entityType:b().string.isRequired,onPermissionChanged:b().func.isRequired};var L=n(92516),z=n.n(L),H=n(2543),Y=function(e){var t,n=e.result,l=e.record,c=e.onItemAddedOrDeleted,u=e.onPermissionChanged,d=e.dropdownOptions,p=(0,a.useState)(!1),m=(0,r.A)(p,2),f=m[0],v=m[1],h=(0,a.useState)(!1),A=(0,r.A)(h,2),g=A[0],y=A[1],b=(0,a.useState)(void 0),w=(0,r.A)(b,2),x=w[0],M=w[1],O=void 0;(0,a.useEffect)((function(){return function(){O&&O.cancel()}}),[O]);var S=function(){var e=(0,k.A)(C().mark((function e(){return C().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return y(!0),O=(0,R.withCancel)(R.http.delete("".concat(l.links.access_links,"/").concat(n.id))),e.prev=2,e.next=5,O.promise;case 5:y(!1),c(l.links.access_links,"links"),e.next=14;break;case 9:e.prev=9,e.t0=e.catch(2),y(!1),M(e.t0),console.error(e.t0);case 14:case"end":return e.stop()}}),e,null,[[2,9]])})));return function(){return e.apply(this,arguments)}}(),_=a.createRef();(0,a.useEffect)((function(){var e;null===(e=_.current)||void 0===e||e.focus()}),[_]),(0,a.useEffect)((function(){var e=setTimeout((function(){v(!1)}),1500);return function(){clearTimeout(e)}}),[f]);return a.createElement(q.A.Row,{key:n.id},x&&a.createElement(R.ErrorMessage,{header:E.M.t("Something went wrong"),content:(null===x||void 0===x||null===(t=x.response)||void 0===t||null===(t=t.data)||void 0===t?void 0:t.message)||x.message,icon:"exclamation",negative:!0,size:"mini"}),!x&&a.createElement(a.Fragment,null,a.createElement(q.A.Cell,{width:3,"data-label":"Link title"},(0,H.isEmpty)(n.description)?"-":z()(n.description,{length:60})),a.createElement(q.A.Cell,{width:3,"data-label":"Created"},(0,U.$)(n.created_at)),a.createElement(q.A.Cell,{width:3,"data-label":"Expires at"},(0,H.isEmpty)(n.expires_at)?E.M.t("Never"):"".concat((0,U.$)(n.expires_at)," (").concat(n.expires_at,")")),a.createElement(q.A.Cell,{width:3,"data-label":"Access"},a.createElement(F,{updateEndpoint:"".concat(l.links.access_links,"/").concat(n.id),dropdownOptions:d,result:n,onPermissionChanged:u,entityType:"links"})),a.createElement(q.A.Cell,{width:4},a.createElement(s.A,{loading:g,disabled:g,onClick:S,icon:!0,labelPosition:"left",negative:!0,size:"small"},a.createElement(i.A,{name:"trash"}),E.M.t("Delete")),a.createElement(o.A,{position:"top center",content:E.M.t("Copied!"),inverted:!0,open:f,on:"click",size:"small",trigger:a.createElement(s.A,{ref:_,onClick:function(){return function(){var e="";"view"===(null===n||void 0===n?void 0:n.permission)?e="".concat(l.links.record_html||l.links.self_html,"?"):"preview"===(null===n||void 0===n?void 0:n.permission)?e="".concat(l.links.record_html||l.links.self_html,"?preview=1&"):"edit"===(null===n||void 0===n?void 0:n.permission)&&(e="".concat(l.links.self_html,"?"));var t="".concat(e,"token=").concat(n.token);navigator.clipboard.writeText(t),v(!0)}(null===n||void 0===n||n.id)},"aria-label":E.M.t("Copy link"),size:"small",icon:!0,labelPosition:"left"},a.createElement(i.A,{name:"copy outline"}),E.M.t("Copy link"))}))))};Y.propTypes={result:b().object.isRequired,record:b().object.isRequired,onItemAddedOrDeleted:b().func.isRequired,onPermissionChanged:b().func.isRequired,dropdownOptions:b().array.isRequired};var V=n(88055),K=n.n(V);function W(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(W=function(){return!!e})()}var $=[{key:"view",name:"view",text:E.M.t("Can view"),title:E.M.t("Can view"),value:"view",description:E.M.t("Can view restricted files of all versions of this record.")},{key:"preview",name:"preview",text:E.M.t("Can preview drafts"),title:E.M.t("Can preview drafts"),value:"preview",description:E.M.t("Can view drafts and restricted files of all versions of this record.")},{key:"edit",name:"edit",text:E.M.t("Can edit"),title:E.M.t("Can edit"),value:"edit",description:E.M.t("Can edit drafts and view restricted files of all versions of this record.")}],J=function(e){function t(e){var n,r,o,s;return(0,l.A)(this,t),r=this,o=t,s=[e],o=(0,d.A)(o),n=(0,u.A)(r,W()?Reflect.construct(o,s||[],(0,d.A)(r).constructor):o.apply(r,s)),(0,m.A)(n,"errorMessage",(function(){var e,t,r=n.state.error,o=(null===r||void 0===r||null===(e=r.response)||void 0===e||null===(e=e.data)||void 0===e?void 0:e.message)||(null===r||void 0===r?void 0:r.message),s=null===r||void 0===r||null===(t=r.response)||void 0===t||null===(t=t.data)||void 0===t?void 0:t.errors;return a.createElement(_.A,{className:"mb-30",negative:!0},o,s&&s.map((function(e){return a.createElement(_.A.Item,{key:e.field},a.createElement("b",null,e.field.charAt(0).toUpperCase()+e.field.slice(1).replace("_"," ")),": ",n.renderErrorMessages(e.messages))})))})),(0,m.A)(n,"handleCreation",function(){var e=(0,k.A)(C().mark((function e(t,r,a){var o,s,i,l;return C().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=n.props,s=o.onItemAddedOrDeleted,i=o.record,n.setState({loading:!0}),e.prev=2,l={permission:t,expires_at:r,description:a},n.cancellableAction=(0,R.withCancel)(R.http.post(i.links.access_links,l)),e.next=7,n.cancellableAction.promise;case 7:s(i.links.access_links,"links"),n.setState({loading:!1,error:void 0}),e.next=17;break;case 11:if(e.prev=11,e.t0=e.catch(2),"UNMOUNTED"!==e.t0){e.next=15;break}return e.abrupt("return");case 15:n.setState({loading:!1,error:e.t0}),console.error(e.t0);case 17:case"end":return e.stop()}}),e,null,[[2,11]])})));return function(t,n,r){return e.apply(this,arguments)}}()),(0,m.A)(n,"generateDropdownOptions",(function(){var e=n.props.record,t=K()($);(null!==e&&void 0!==e&&e.is_draft||null===(null===e||void 0===e?void 0:e.is_draft))&&(t.find((function(e){return"view"===e.key})).text=E.M.t("Can view (view access link can be created only after the record is published)"));var r=(0,R.dropdownOptionsGenerator)(t);(null!==e&&void 0!==e&&e.is_draft||null===(null===e||void 0===e?void 0:e.is_draft))&&(r.find((function(e){return"view"===e.key})).disabled=!0);return r})),n.state={loading:!1,error:void 0},n}return(0,p.A)(t,e),(0,c.A)(t,[{key:"componentWillUnmount",value:function(){this.cancellableAction&&this.cancellableAction.cancel()}},{key:"renderErrorMessages",value:function(e){var t=(0,M.A)(new Set(e));return 1===t.length?e[0]:a.createElement("ul",null,t.map((function(e){return a.createElement("li",{key:e},e)})))}},{key:"render",value:function(){var e=this,t=this.props,n=t.results,r=t.record,o=t.onItemAddedOrDeleted,s=t.onPermissionChanged,i=this.state,l=i.loading,c=i.error;return a.createElement(a.Fragment,null,c&&this.errorMessage(),a.createElement(q.A,{className:"fixed-header"},a.createElement(q.A.Header,null,a.createElement(q.A.Row,null,a.createElement(q.A.HeaderCell,{"data-label":"Link title",width:3},E.M.t("Link title")),a.createElement(q.A.HeaderCell,{"data-label":"Created",width:3},E.M.t("Created")),a.createElement(q.A.HeaderCell,{"data-label":"Expires at",width:3},E.M.t("Expires")),a.createElement(q.A.HeaderCell,{"data-label":"Access",width:3},E.M.t("Access")),a.createElement(q.A.HeaderCell,{width:4}))),a.createElement(q.A.Body,null,l?a.createElement(x.A,null):S()(n)?a.createElement(q.A.Row,{textAlign:"center"},a.createElement("p",{className:"mt-10"},a.createElement("i",null,a.createElement("h5",null,E.M.t("This record has no links generated yet."))))):n.map((function(t){return a.createElement(Y,{key:t.id,result:t,record:r,onItemAddedOrDeleted:o,onPermissionChanged:s,dropdownOptions:"view"===t.permission?(0,R.dropdownOptionsGenerator)($):e.generateDropdownOptions()})})))),a.createElement(q.A,{color:"green"},a.createElement(j,{handleCreation:this.handleCreation,loading:l,record:r,dropdownOptions:this.generateDropdownOptions()})))}}])}(a.Component);function Q(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(Q=function(){return!!e})()}J.propTypes={results:b().array.isRequired,record:b().object.isRequired,onItemAddedOrDeleted:b().func.isRequired,onPermissionChanged:b().func.isRequired};var X=function(e){function t(e){var n,r,a,o;return(0,l.A)(this,t),r=this,a=t,o=[e],a=(0,d.A)(a),n=(0,u.A)(r,Q()?Reflect.construct(a,o||[],(0,d.A)(r).constructor):a.apply(r,o)),(0,m.A)(n,"onLinksAddedOrDeleted",(0,k.A)(C().mark((function e(){return C().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.fetchLinks(!0);case 2:case"end":return e.stop()}}),e)})))),(0,m.A)(n,"onPermissionChanged",(function(e,t){n.props.results.forEach((function(n){n.id===e&&(n.permission=t)}))})),(0,m.A)(n,"fetchLinks",function(){var e=(0,k.A)(C().mark((function e(t){var r,a,o,s,i;return C().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=n.props,a=r.record,o=r.results,s=r.updateLinksState,!o||t){e.next=3;break}return e.abrupt("return");case 3:return n.setState({loading:!0}),e.prev=4,n.cancellableAction=(0,R.withCancel)(R.http.get(a.links.access_links)),e.next=8,n.cancellableAction.promise;case 8:i=e.sent,n.setState({loading:!1,error:void 0}),s(i.data.hits.hits,t),e.next=19;break;case 13:if(e.prev=13,e.t0=e.catch(4),"UNMOUNTED"!==e.t0){e.next=17;break}return e.abrupt("return");case 17:n.setState({loading:!1,error:e.t0}),console.error(e.t0);case 19:case"end":return e.stop()}}),e,null,[[4,13]])})));return function(t){return e.apply(this,arguments)}}()),n.state={loading:!1,error:void 0},n}return(0,p.A)(t,e),(0,c.A)(t,[{key:"componentDidMount",value:function(){this.fetchLinks()}},{key:"componentWillUnmount",value:function(){this.cancellableAction&&this.cancellableAction.cancel()}},{key:"render",value:function(){var e,t=this.props,n=t.record,r=t.results,o=this.state,s=o.loading,i=o.error;return a.createElement(a.Fragment,null,i&&a.createElement(R.ErrorMessage,{header:E.M.t("Something went wrong"),content:(null===i||void 0===i||null===(e=i.response)||void 0===e||null===(e=e.data)||void 0===e?void 0:e.message)||i.message,icon:"exclamation",negative:!0,size:"mini"}),a.createElement(g.A.Content,{className:"share-content"},s&&a.createElement(x.A,null),!s&&void 0!==r&&a.createElement(J,{results:r,record:n,onItemAddedOrDeleted:this.onLinksAddedOrDeleted,onPermissionChanged:this.onPermissionChanged})))}}])}(a.Component);X.propTypes={record:b().string.isRequired,results:b().array.isRequired,updateLinksState:b().func.isRequired};var Z=n(61448),ee=n.n(Z);function te(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(te=function(){return!!e})()}var ne=function(e){function t(e){var n,r,a,o;(0,l.A)(this,t),r=this,a=t,o=[e],a=(0,d.A)(a),n=(0,u.A)(r,te()?Reflect.construct(a,o||[],(0,d.A)(r).constructor):a.apply(r,o)),(0,m.A)(n,"handleOnChange",(function(e){var t=e.data;e.formikProps.form.setFieldValue("secret_link_expiration",t.value)}));var s=e.expirationOptions;return n.expirationOptions=s,n}return(0,p.A)(t,e),(0,c.A)(t,[{key:"render",value:function(){var e=this.props,t=e.inline,n=e.expirationOptions,r=e.value,o=r?r.toString():n[0].value;return a.createElement(R.SelectField,{label:E.M.t("Link expiration"),inline:t,fieldPath:"secret_link_expiration",options:this.expirationOptions,onChange:this.handleOnChange,value:o,defaultValue:n[0]})}}])}(a.Component);ne.propTypes={expirationOptions:b().arrayOf(b().shape({key:b().string.isRequired,text:b().string.isRequired,value:b().string.isRequired})),inline:b().bool,value:b().string},ne.defaultProps={expirationOptions:[{key:0,text:E.M.t("Never"),value:"0"},{key:30,text:E.M.t("In 1 month"),value:"30"},{key:60,text:E.M.t("In 2 months"),value:"60"},{key:180,text:E.M.t("In 6 months"),value:"180"},{key:365,text:E.M.t("In 1 year"),value:"365"}],inline:!1,value:void 0};var re=n(80501),ae=n(50363),oe=n(36713),se=n(17684),ie=n(15941),le=n(58156),ce=n.n(le);function ue(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function de(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(de=function(){return!!e})()}var pe=function(e){function t(e){var n,r,a,o;return(0,l.A)(this,t),r=this,a=t,o=[e],a=(0,d.A)(a),n=(0,u.A)(r,de()?Reflect.construct(a,o||[],(0,d.A)(r).constructor):a.apply(r,o)),(0,m.A)(n,"accessRequestSchema",ie.Ik({allow_user_requests:ie.lc(),allow_guest_requests:ie.lc(),accept_conditions_text:ie.Yj().nullable(),secret_link_expiration:ie.Yj()})),(0,m.A)(n,"handleSubmit",function(){var e=(0,k.A)(C().mark((function e(t){var r,a,o,s,i,l;return C().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n.setState({loading:!0,actionSuccess:!1}),r=n.props,a=r.record,o=r.successCallback,s={allow_user_requests:t.allow_user_requests,allow_guest_requests:t.allow_guest_requests,accept_conditions_text:t.accept_conditions_text,secret_link_expiration:t.secret_link_expiration},n.cancellableAction=(0,R.withCancel)(R.http.put(a.links.access,s)),e.prev=4,e.next=7,n.cancellableAction.promise;case 7:i=e.sent,n.setState({loading:!1,actionSuccess:!0,error:void 0}),o(i.data),e.next=18;break;case 12:if(e.prev=12,e.t0=e.catch(4),"UNMOUNTED"!==e.t0){e.next=16;break}return e.abrupt("return");case 16:n.setState({error:(null===e.t0||void 0===e.t0||null===(l=e.t0.response)||void 0===l||null===(l=l.data)||void 0===l?void 0:l.message)||(null===e.t0||void 0===e.t0?void 0:e.t0.message),loading:!1,actionSuccess:!1}),console.error(e.t0);case 18:case"end":return e.stop()}}),e,null,[[4,12]])})));return function(t){return e.apply(this,arguments)}}()),(0,m.A)(n,"initFormValues",(function(){var e=n.props.record.parent.access.settings;return ee()(e,"secret_link_expiration")||(e.secret_link_expiration=0),function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ue(Object(n),!0).forEach((function(t){(0,m.A)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ue(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},e)})),n.state={loading:!1,error:void 0,actionSuccess:void 0},n}return(0,p.A)(t,e),(0,c.A)(t,[{key:"componentWillUnmount",value:function(){this.cancellableAction&&this.cancellableAction.cancel()}},{key:"render",value:function(){var e=this.state,t=e.loading,n=e.error,r=e.actionSuccess,o=this.props.handleClose;return a.createElement(se.Formik,{onSubmit:this.handleSubmit,enableReinitialize:!0,initialValues:this.initFormValues(),validationSchema:this.accessRequestSchema},(function(e){var i=e.values,l=e.handleSubmit;return a.createElement(a.Fragment,null,a.createElement(g.A.Content,{className:"share-content"},n&&a.createElement(R.ErrorMessage,{header:E.M.t("Unable to change the access request settings."),content:E.M.t(n),icon:"exclamation",className:"text-align-left",negative:!0}),a.createElement(N.A,null,a.createElement(re.A,null,a.createElement(N.A,null,a.createElement(N.A.Row,null,a.createElement(N.A.Column,{width:16},a.createElement(re.A.Field,null,a.createElement(R.RadioField,{checked:ce()(i,"allow_user_requests"),control:ae.A,fieldPath:"allow_user_requests",label:E.M.t("Allow authenticated users to request access to restricted files."),onChange:function(e){var t=e.data;e.formikProps.form.setFieldValue("allow_user_requests",t.checked)}})),a.createElement(re.A.Field,null,a.createElement(R.RadioField,{checked:ce()(i,"allow_guest_requests"),control:ae.A,fieldPath:"allow_guest_requests",label:E.M.t("Allow non-authenticated users to request access to restricted files."),onChange:function(e){var t=e.data;e.formikProps.form.setFieldValue("allow_guest_requests",t.checked)}})),a.createElement("label",{className:"helptext mb-0 mt-10"},E.M.t("Enable users and guests to request access to your record's files. When access is requested by someone, you will get an e-mail asking for approval. After you approve a request, users will be granted access and guests will receive a secret link.")))),a.createElement(N.A.Row,null,a.createElement(N.A.Column,null,a.createElement("h5",null,E.M.t("Accept conditions")),a.createElement("label",{className:"helptext mb-0 mt-10"},E.M.t("Optional. Specify conditions under which you approve access. This message will be visible for any user when requesting access to this record.")),a.createElement(re.A.Field,null,a.createElement(R.RichInputField,{fieldPath:"accept_conditions_text"}))))),a.createElement("h5",null,E.M.t("Advanced options")),a.createElement(oe.A,null),a.createElement(N.A,null,a.createElement(N.A.Row,null,a.createElement(N.A.Column,{width:3},a.createElement(re.A.Field,null,a.createElement(ne,{inline:!0,value:i.secret_link_expiration})))))),a.createElement(N.A.Row,null,a.createElement(N.A.Column,null,a.createElement("br",null))))),a.createElement(g.A.Actions,null,r&&a.createElement(B.BK,{className:"ml-10",timeOutDelay:3e3,show:r}),a.createElement(s.A,{size:"small",onClick:o,floated:"left",content:E.M.t("Cancel"),icon:"remove"}),a.createElement(s.A,{size:"small",labelPosition:"left",icon:"checkmark",primary:!0,content:E.M.t("Save"),onClick:function(e){return l(e)},loading:t,disabled:t})))}))}}])}(a.Component);pe.propTypes={record:b().string.isRequired,successCallback:b().func.isRequired,handleClose:b().func.isRequired};var me=n(23848),fe=(0,c.A)((function e(t){var n=this;(0,l.A)(this,e),(0,m.A)(this,"createGrants",function(){var e=(0,k.A)(C().mark((function e(t,a,o,s){var i,l,c,u,d,p,m,f;return C().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(i=[],l=0,c=Object.entries(t);l<c.length;l++)u=(0,r.A)(c[l],2),d=u[0],p=u[1],m={subject:{type:p.type,id:d},permission:a},s&&(m.notify=s),o&&(m.message=o),i.push(m);return f={grants:i},e.next=5,R.http.post(n.endpoint,f);case 5:case"end":return e.stop()}}),e)})));return function(t,n,r,a){return e.apply(this,arguments)}}()),this.endpoint=t.links.access_grants})),ve=n(15368);function he(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(he=function(){return!!e})()}var Ae=function(e){function t(e){var n,r,a,o;return(0,l.A)(this,t),r=this,a=t,o=[e],a=(0,d.A)(a),n=(0,u.A)(r,he()?Reflect.construct(a,o||[],(0,d.A)(r).constructor):a.apply(r,o)),(0,m.A)(n,"onSuccess",(function(){var e=n.props,t=e.onGrantAddedOrDeleted,r=e.endpoint,a=e.searchType;t("".concat(r,"?expand=true"),a),n.handleCloseModal()})),(0,m.A)(n,"updateMessage",(function(e){n.setState({message:e})})),(0,m.A)(n,"handleNotifyCheckboxClick",(function(){var e=n.state.notifyUser;n.setState({notifyUser:!e})})),(0,m.A)(n,"handleOpenModal",(function(){return n.setState({open:!0})})),(0,m.A)(n,"handleCloseModal",(function(){n.setState({open:!1,notifyUser:!0})})),(0,m.A)(n,"searchEntities",(function(){var e=n.props.searchType;return"user"===e?(new ve.lK).suggestUsers:"role"===e?(new ve.D4).getGroups:void 0})),n.state={open:!1,notifyUser:!0,message:void 0},n}return(0,p.A)(t,e),(0,c.A)(t,[{key:"render",value:function(){var e,t=this,n=this.props,r=n.results,o=n.record,i=n.isComputer,l=n.accessDropdownOptions,c=n.searchType,u=this.state,d=u.open,p=u.notifyUser,m=u.message,f=new fe(o),v=[null===(e=o.parent)||void 0===e||null===(e=e.access)||void 0===e||null===(e=e.owned_by)||void 0===e?void 0:e.user];r.forEach((function(e){var t;v.push(null===e||void 0===e||null===(t=e.subject)||void 0===t?void 0:t.id)}));var h="",A="",y="",b="",k="",w="";return"user"===c&&(h=E.M.t("Add people"),A=E.M.t("User"),y=E.M.t("No selected users"),b=E.M.t("Search for users to grant access (only users with a public profile can be invited)"),k=E.M.t("Search by email, full name or username"),w=E.M.t("users")),"role"===c&&(h=E.M.t("Add groups"),A=E.M.t("Group"),y=E.M.t("No selected groups"),k=E.M.t("Search for groups"),w=E.M.t("groups")),a.createElement(g.A,{role:"dialog",closeIcon:!0,onClose:this.handleCloseModal,onOpen:this.handleOpenModal,closeOnDimmerClick:!1,open:d,"aria-label":h,trigger:a.createElement(s.A,{className:i?"":"mobile only tablet only mb-15",content:h,positive:!0,size:"medium",icon:"plus",labelPosition:"left",floated:i?void 0:"right"})},a.createElement(g.A.Header,{as:"h2"},h),a.createElement(B.Lr,{key:"access-users",roleOptions:l,modalClose:this.handleCloseModal,action:f.createGrants,fetchMembers:this.searchEntities(),onSuccessCallback:this.onSuccess,searchBarTitle:a.createElement("label",null,A),searchBarTooltip:b,doneButtonText:E.M.t("Add"),doneButtonIcon:"plus",radioLabel:E.M.t("Access"),selectedItemsHeader:y,message:m,searchType:c,messageComponent:a.createElement(a.Fragment,null,a.createElement(ae.A,{checked:p,className:"mb-20 mt-10",label:E.M.t("Notify people"),onClick:this.handleNotifyCheckboxClick}),p&&a.createElement(a.Fragment,null,a.createElement("p",null,a.createElement("b",null,E.M.t("Notification message"))),a.createElement(R.RichEditor,{inputValue:function(){return m},onBlur:function(e,n){t.updateMessage(n.getContent())}}))),notify:p,doneButtonTip:E.M.t("You are about to add"),doneButtonTipType:w,existingEntities:v,existingEntitiesDescription:E.M.t("Access already granted"),searchBarPlaceholder:k}))}}])}(a.Component);function ge(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(ge=function(){return!!e})()}Ae.propTypes={record:b().object.isRequired,results:b().array.isRequired,isComputer:b().bool.isRequired,accessDropdownOptions:b().array.isRequired,onGrantAddedOrDeleted:b().func.isRequired,endpoint:b().string.isRequired,searchType:b().oneOf(["group","role","user"]).isRequired};var Ee=[].concat((0,M.A)($),[{key:"manage",name:"manage",text:E.M.t("Can manage"),title:E.M.t("Can manage"),value:"manage",description:E.M.t("Can manage access, edit drafts and view restricted files of all versions of this record.")}]),ye=function(e){function t(e){var n,r,a,o;return(0,l.A)(this,t),r=this,a=t,o=[e],a=(0,d.A)(a),n=(0,u.A)(r,ge()?Reflect.construct(a,o||[],(0,d.A)(r).constructor):a.apply(r,o)),(0,m.A)(n,"handleDelete",(0,k.A)(C().mark((function e(){var t,r,a,o,s;return C().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=n.props,a=r.result,o=r.endpoint,n.setState({loading:!0}),s=(0,R.withCancel)(R.http.delete("".concat(o,"/").concat(null===a||void 0===a||null===(t=a.expanded)||void 0===t||null===(t=t.subject)||void 0===t?void 0:t.id))),e.prev=3,e.next=6,s.promise;case 6:n.setState({loading:!1,success:!0}),n.handleSuccess(),e.next=14;break;case 10:e.prev=10,e.t0=e.catch(3),n.setState({loading:!1,error:e.t0}),console.error(e.t0);case 14:case"end":return e.stop()}}),e,null,[[3,10]])})))),(0,m.A)(n,"handleSuccess",(function(){var e=n.props,t=e.onGrantAddedOrDeleted,r=e.endpoint,a=e.searchType;t("".concat(r,"?expand=true"),a)})),n.state={loading:!1,success:void 0,error:void 0},n}return(0,p.A)(t,e),(0,c.A)(t,[{key:"render",value:function(){var e,t,n,r,o,i=this.props,l=i.result,c=i.permissions,u=i.endpoint,d=i.searchType,p=i.onPermissionChanged,m=this.state,f=m.loading,h=m.success,A=m.error,g=l.expanded.subject;return a.createElement(q.A.Row,null,A&&a.createElement(R.ErrorMessage,{header:E.M.t("Something went wrong"),content:(null===A||void 0===A||null===(e=A.response)||void 0===e||null===(e=e.data)||void 0===e?void 0:e.message)||A.message,icon:"exclamation",negative:!0,size:"mini"}),!A&&a.createElement(a.Fragment,null,a.createElement(q.A.Cell,{width:8},a.createElement(N.A,{textAlign:"left",verticalAlign:"middle"},a.createElement(N.A.Column,null,a.createElement(me.A,{className:"flex",key:l.id},a.createElement(R.Image,{src:g.links.avatar,avatar:!0,className:"rel-ml-1",alt:""}),a.createElement(me.A.Content,{className:"ml-10 p-0"},a.createElement(me.A.Header,{className:"flex align-items-center ".concat(g.description?"":"mt-5")},a.createElement("b",{className:"mr-10"},(null===(t=g.profile)||void 0===t?void 0:t.full_name)||(null===g||void 0===g?void 0:g.username)||(null===g||void 0===g?void 0:g.name)),g.is_current_user&&a.createElement(v.A,{size:"tiny",className:"primary"},E.M.t("You"))),(null===(n=g.profile)||void 0===n?void 0:n.affiliations)&&a.createElement(me.A.Meta,null,null===(r=g.profile)||void 0===r?void 0:r.affiliations)))))),a.createElement(q.A.Cell,{"data-label":E.M.t("Access"),width:4},a.createElement(F,{updateEndpoint:"".concat(u,"/").concat(null===l||void 0===l||null===(o=l.expanded)||void 0===o||null===(o=o.subject)||void 0===o?void 0:o.id),dropdownOptions:(0,R.dropdownOptionsGenerator)(Ee),result:l,onPermissionChanged:p,entityType:d})),a.createElement(q.A.Cell,{"data-label":E.M.t("Actions"),textAlign:"center",width:3},a.createElement("div",null,c.can_manage&&a.createElement(a.Fragment,null,h&&a.createElement(B.BK,{timeOutDelay:3e3,show:h}),a.createElement(s.A,{size:"small",labelPosition:"left",icon:"trash",className:"fluid-computer-only",compact:!0,negative:!0,disabled:f,loading:f,content:E.M.t("Delete"),onClick:this.handleDelete}))))))}}])}(a.Component);function be(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(be=function(){return!!e})()}ye.propTypes={result:b().object.isRequired,permissions:b().object.isRequired,onGrantAddedOrDeleted:b().func.isRequired,onPermissionChanged:b().func.isRequired,endpoint:b().string.isRequired,searchType:b().oneOf(["group","role","user"]).isRequired};var ke=function(e){function t(){return(0,l.A)(this,t),e=this,n=t,r=arguments,n=(0,d.A)(n),(0,u.A)(e,be()?Reflect.construct(n,r||[],(0,d.A)(e).constructor):n.apply(e,r));var e,n,r}return(0,p.A)(t,e),(0,c.A)(t,[{key:"componentWillUnmount",value:function(){this.cancellableAction&&this.cancellableAction.cancel()}},{key:"render",value:function(){var e,t,n,r,o,s=this.props,i=s.record,l=s.permissions,c=s.endpoint,u=s.searchType,d=s.results,p=s.loading,m=s.error,f=s.onGrantAddedOrDeleted,h=s.onPermissionChanged,y=null===i||void 0===i||null===(e=i.expanded)||void 0===e||null===(e=e.parent)||void 0===e||null===(e=e.access)||void 0===e?void 0:e.owned_by,b="",k="";return"user"===u&&(b=E.M.t("No user has access to this record yet."),k=E.M.t("People with access")),"role"===u&&(b=E.M.t("No group has access to this record yet."),k=E.M.t("Groups with access")),a.createElement(a.Fragment,null,m&&a.createElement(R.ErrorMessage,{header:E.M.t("Something went wrong"),content:(null===m||void 0===m||null===(t=m.response)||void 0===t||null===(t=t.data)||void 0===t?void 0:t.message)||m.message,icon:"exclamation",className:"text-align-left",negative:!0,size:"mini"}),a.createElement(g.A.Content,{className:"share-content"},p&&a.createElement(x.A,{isLoading:!0,active:!0}),!p&&void 0!==d&&a.createElement(a.Fragment,null,a.createElement(Ae,{isComputer:!1,accessDropdownOptions:Ee,results:d,record:i,onGrantAddedOrDeleted:f,searchType:u,endpoint:c}),a.createElement(q.A,{className:"fixed-header"},a.createElement(q.A.Header,null,a.createElement(q.A.Row,null,a.createElement(q.A.HeaderCell,{width:8},k),a.createElement(q.A.HeaderCell,{"data-label":"Access",width:4},E.M.t("Access")),a.createElement(q.A.HeaderCell,{textAlign:"center",width:3},a.createElement(Ae,{isComputer:!0,accessDropdownOptions:Ee,results:d,record:i,onGrantAddedOrDeleted:f,searchType:u,endpoint:c})))),a.createElement(q.A.Body,null,"user"===u&&y&&a.createElement(q.A.Row,null,a.createElement(q.A.Cell,{width:8},a.createElement(N.A,{textAlign:"left",verticalAlign:"middle"},a.createElement(N.A.Column,null,a.createElement(me.A,{className:"flex"},a.createElement(R.Image,{src:y.links.avatar,avatar:!0,className:"rel-ml-1",alt:""}),a.createElement(me.A.Content,{className:"ml-10 p-0"},a.createElement(me.A.Header,{className:"flex align-items-center ".concat(y.description?"":"mt-5")},a.createElement("b",{className:"mr-10"},(null===(n=y.profile)||void 0===n?void 0:n.full_name)||y.username),y.is_current_user&&a.createElement(v.A,{size:"tiny",className:"primary"},E.M.t("You"))),(null===(r=y.profile)||void 0===r?void 0:r.affiliations)&&a.createElement(me.A.Meta,null,null===(o=y.profile)||void 0===o?void 0:o.affiliations)))))),a.createElement(q.A.Cell,{textAlign:"left","data-label":E.M.t("Access"),width:4},E.M.t("Owner")),a.createElement(q.A.Cell,{width:3})),d.map((function(e){return a.createElement(ye,{key:e.subject.id,result:e,permissions:l,onGrantAddedOrDeleted:f,onPermissionChanged:h,endpoint:c,searchType:u})}))))),!p&&!m&&S()(d)&&a.createElement(A.A,{className:"mt-10",textAlign:"center"},a.createElement("h5",null,b))))}}])}(a.Component);function we(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(we=function(){return!!e})()}ke.propTypes={record:b().object.isRequired,permissions:b().object.isRequired,endpoint:b().string.isRequired,searchType:b().oneOf(["group","role","user"]).isRequired,onGrantAddedOrDeleted:b().func.isRequired,onPermissionChanged:b().func.isRequired,results:b().array.isRequired,loading:b().bool.isRequired,error:b().object.isRequired};var Ce=function(e){function t(e){var n,r,a,o;return(0,l.A)(this,t),r=this,a=t,o=[e],a=(0,d.A)(a),n=(0,u.A)(r,we()?Reflect.construct(a,o||[],(0,d.A)(r).constructor):a.apply(r,o)),(0,m.A)(n,"onUserAddedOrDeleted",(0,k.A)(C().mark((function e(){return C().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.fetchUsers(!0);case 2:case"end":return e.stop()}}),e)})))),(0,m.A)(n,"onPermissionChanged",(function(e,t){n.props.results.forEach((function(n){n.subject.id===e&&(n.permission=t)}))})),(0,m.A)(n,"fetchUsers",function(){var e=(0,k.A)(C().mark((function e(t){var r,a,o,s,i;return C().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=n.props,a=r.record,o=r.results,s=r.updateUsersState,!o||t){e.next=3;break}return e.abrupt("return");case 3:return n.setState({loading:!0}),e.prev=4,n.cancellableAction=(0,R.withCancel)(R.http.get("".concat(a.links.access_users,"?expand=true"))),e.next=8,n.cancellableAction.promise;case 8:i=e.sent,n.setState({loading:!1,error:void 0}),s(i.data.hits.hits,t),e.next=19;break;case 13:if(e.prev=13,e.t0=e.catch(4),"UNMOUNTED"!==e.t0){e.next=17;break}return e.abrupt("return");case 17:n.setState({loading:!1,error:e.t0}),console.error(e.t0);case 19:case"end":return e.stop()}}),e,null,[[4,13]])})));return function(t){return e.apply(this,arguments)}}()),n.state={loading:!1,error:void 0},n}return(0,p.A)(t,e),(0,c.A)(t,[{key:"componentDidMount",value:function(){this.fetchUsers()}},{key:"render",value:function(){var e=this.state,t=e.loading,n=e.error,r=this.props,o=r.record,s=r.permissions,i=r.results;return a.createElement(ke,{searchType:"user",record:o,permissions:s,endpoint:"".concat(o.links.access_users),results:i,loading:t,error:n,onGrantAddedOrDeleted:this.onUserAddedOrDeleted,onPermissionChanged:this.onPermissionChanged})}}])}(a.Component);function xe(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(xe=function(){return!!e})()}Ce.propTypes={record:b().object.isRequired,permissions:b().object.isRequired,results:b().array.isRequired,updateUsersState:b().func.isRequired};var Re=function(e){function t(e){var n,r,a,o;return(0,l.A)(this,t),r=this,a=t,o=[e],a=(0,d.A)(a),n=(0,u.A)(r,xe()?Reflect.construct(a,o||[],(0,d.A)(r).constructor):a.apply(r,o)),(0,m.A)(n,"onGroupAddedOrDeleted",(0,k.A)(C().mark((function e(){return C().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.fetchGroups(!0);case 2:case"end":return e.stop()}}),e)})))),(0,m.A)(n,"onPermissionChanged",(function(e,t){n.props.results.forEach((function(n){n.subject.id===e&&(n.permission=t)}))})),(0,m.A)(n,"fetchGroups",function(){var e=(0,k.A)(C().mark((function e(t){var r,a,o,s,i;return C().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=n.props,a=r.record,o=r.results,s=r.updateGroupsState,!o||t){e.next=3;break}return e.abrupt("return");case 3:return n.setState({loading:!0}),e.prev=4,n.cancellableAction=(0,R.withCancel)(R.http.get("".concat(a.links.access_groups,"?expand=true"))),e.next=8,n.cancellableAction.promise;case 8:i=e.sent,n.setState({loading:!1,error:void 0}),s(i.data.hits.hits,t),e.next=19;break;case 13:if(e.prev=13,e.t0=e.catch(4),"UNMOUNTED"!==e.t0){e.next=17;break}return e.abrupt("return");case 17:n.setState({loading:!1,error:e.t0}),console.error(e.t0);case 19:case"end":return e.stop()}}),e,null,[[4,13]])})));return function(t){return e.apply(this,arguments)}}()),n.state={loading:!1,error:void 0},n}return(0,p.A)(t,e),(0,c.A)(t,[{key:"componentDidMount",value:function(){this.fetchGroups()}},{key:"render",value:function(){var e=this.state,t=e.loading,n=e.error,r=this.props,o=r.record,s=r.permissions,i=r.results;return a.createElement(ke,{searchType:"role",record:o,permissions:s,endpoint:"".concat(o.links.access_groups),results:i,loading:t,error:n,onGrantAddedOrDeleted:this.onGroupAddedOrDeleted,onPermissionChanged:this.onPermissionChanged})}}])}(a.Component);function Me(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(Me=function(){return!!e})()}Re.propTypes={record:b().object.isRequired,permissions:b().object.isRequired,results:b().array.isRequired,updateGroupsState:b().func.isRequired};var Oe=function(e){function t(e){var n,r,o,s;(0,l.A)(this,t),r=this,o=t,s=[e],o=(0,d.A)(o),n=(0,u.A)(r,Me()?Reflect.construct(o,s||[],(0,d.A)(r).constructor):o.apply(r,s)),(0,m.A)(n,"updateGroupsState",(function(e,t){if(n.setState({groupsResults:e}),t){var r,a=n.state.record,o=null===a||void 0===a||null===(r=a.parent)||void 0===r||null===(r=r.access)||void 0===r||null===(r=r.grants)||void 0===r?void 0:r.filter((function(e){var t;return"role"!==(null===e||void 0===e||null===(t=e.subject)||void 0===t?void 0:t.type)})).concat(e);a.parent.access.grants=o,n.setState({record:a})}})),(0,m.A)(n,"updateUsersState",(function(e,t){if(n.setState({usersResults:e}),t){var r,a=n.state.record,o=null===a||void 0===a||null===(r=a.parent)||void 0===r||null===(r=r.access)||void 0===r||null===(r=r.grants)||void 0===r?void 0:r.filter((function(e){var t;return"user"!==(null===e||void 0===e||null===(t=e.subject)||void 0===t?void 0:t.type)})).concat(e);a.parent.access.grants=o,n.setState({record:a})}})),(0,m.A)(n,"updateLinksState",(function(e,t){if(n.setState({linksResults:e}),t){var r=n.state.record;r.parent.access.links=e,n.setState({record:r})}})),(0,m.A)(n,"handleTabChange",(function(e,t){var r,a=t.activeIndex;n.setState({activeTabKey:null===t||void 0===t||null===(r=t.panes[a])||void 0===r||null===(r=r.menuItem)||void 0===r?void 0:r.key})})),(0,m.A)(n,"handleRecordUpdate",(function(e){var t=n.state.record;e.expanded=t.expanded,n.setState({record:e})})),(0,m.A)(n,"panes",(function(e,t){var r,o,s,l=n.props,c=l.handleClose,u=l.groupsEnabled,d=n.state,p=d.linksResults,m=d.groupsResults,g=d.usersResults,y=0,b=0;null===(r=e.parent)||void 0===r||null===(r=r.access)||void 0===r||null===(r=r.grants)||void 0===r||r.forEach((function(e){"user"===e.subject.type&&y++,"role"===e.subject.type&&b++})),null!==e&&void 0!==e&&null!==(o=e.expanded)&&void 0!==o&&null!==(o=o.parent)&&void 0!==o&&null!==(o=o.access)&&void 0!==o&&o.owned_by&&y++;var k=[{menuItem:a.createElement(f.A,{key:"accessUsers"},a.createElement(i.A,{name:"user"}),E.M.t("People"),a.createElement(v.A,{size:"tiny"},y)),render:function(){return a.createElement(h.A.Pane,{key:"accessUsers",as:A.A},a.createElement(Ce,{record:e,permissions:t,results:g,updateUsersState:n.updateUsersState}))}}];u&&k.push({menuItem:a.createElement(f.A,{key:"accessGroups"},a.createElement(i.A,{name:"users"}),E.M.t("Groups"),a.createElement(v.A,{size:"tiny"},b)),render:function(){return a.createElement(h.A.Pane,{key:"accessGroups",as:A.A},a.createElement(Re,{record:e,permissions:t,results:m,updateGroupsState:n.updateGroupsState}))}});var w=0;return null===(s=e.parent)||void 0===s||null===(s=s.access)||void 0===s||null===(s=s.links)||void 0===s||s.forEach((function(e){null!==e.id&&w++})),k.push({menuItem:a.createElement(f.A,{key:"accessLinks"},a.createElement(i.A,{name:"linkify"}),E.M.t("Links"),a.createElement(v.A,{size:"tiny"},w)),render:function(){return a.createElement(h.A.Pane,{key:"accessLinks",as:A.A},a.createElement(X,{results:p,record:e,updateLinksState:n.updateLinksState}))}},{menuItem:a.createElement(f.A,{key:"accessRequests"},a.createElement(i.A,{name:"cog"}),E.M.t("Settings")),render:function(){return a.createElement(h.A.Pane,{key:"accessRequests",as:A.A},a.createElement(pe,{record:e,handleClose:c,successCallback:n.handleRecordUpdate}))}}),k}));var c=n.props.record;return n.state={record:c,usersResults:void 0,groupsResults:void 0,linksResults:void 0,activeTabKey:""},n}return(0,p.A)(t,e),(0,c.A)(t,[{key:"render",value:function(){var e=this.props,t=e.open,n=e.handleClose,r=e.permissions,o=this.state,l=o.record,c="accessRequests"!==o.activeTabKey;return a.createElement(g.A,{open:t,closeIcon:!0,onClose:n,className:"record-share-modal",role:"dialog","aria-labelledby":"access-link-modal-header","aria-modal":"true","tab-index":"-1",size:"large",closeOnDimmerClick:!1},a.createElement(g.A.Header,{as:"h2",id:"access-link-modal-header"},a.createElement(i.A,{name:"share square"}),E.M.t("Share access")),a.createElement(h.A,{menu:{secondary:!0,pointing:!0},panes:this.panes(l,r),onTabChange:this.handleTabChange}),c&&a.createElement(g.A.Actions,{className:"ui clearing segment"},a.createElement(s.A,{size:"small",onClick:n,content:E.M.t("Close"),className:"left floated clearing"})))}}])}(a.Component);Oe.propTypes={record:b().object.isRequired,open:b().bool.isRequired,groupsEnabled:b().bool.isRequired,handleClose:b().func.isRequired,permissions:b().object.isRequired};var Se=function(e){var t=e.disabled,n=e.record,l=e.permissions,c=e.groupsEnabled,u=(0,a.useState)(!1),d=(0,r.A)(u,2),p=d[0],m=d[1];return a.createElement(a.Fragment,null,a.createElement(o.A,{content:E.M.t("You don't have permissions to share this record."),disabled:!t,trigger:a.createElement(s.A,{fluid:!0,onClick:function(){return m(!0)},disabled:t,primary:!0,size:"medium","aria-haspopup":"dialog",icon:!0,labelPosition:"left"},a.createElement(i.A,{name:"share square"}),E.M.t("Share"))}),a.createElement(Oe,{open:p,handleClose:function(){return m(!1)},record:n,permissions:l,groupsEnabled:c}))};Se.propTypes={disabled:b().bool,record:b().object.isRequired,permissions:b().object.isRequired,groupsEnabled:b().bool.isRequired},Se.defaultProps={disabled:!1}},38992:(e,t,n)=>{n.d(t,{$:()=>c,h:()=>l});var r=n(58156),a=n.n(r),o=n(96540),s=n(70742),i=n(91272);function l(e){var t=e.creators,n=e.className,r=e.othersLink,i="creatibutor-wrap separated";function l(e){var t=a()(e,"person_or_org.identifiers",[]),n=a()(e,"person_or_org.name","No name");return t.map((function(e){return function(e,t,n){var r=null,a=null,i=null,l="";switch(e){case"orcid":r="https://orcid.org/".concat(t),a=s.M.t("ORCID profile"),i="/static/images/orcid.svg",l="ORCID logo";break;case"ror":r="https://ror.org/".concat(t),a=s.M.t("ROR profile"),i="/static/images/ror-icon.svg",l="ROR logo";break;case"gnd":r="https://d-nb.info/gnd/".concat(t),a=s.M.t("GND profile"),i="/static/images/gnd-icon.svg",l="GND logo";break;default:return null}return o.createElement("a",{className:"no-text-decoration mr-0",href:r,"aria-label":"".concat(n,": ").concat(a),title:"".concat(n,": ").concat(a),key:e},o.createElement("img",{className:"inline-id-icon ml-5",src:i,alt:l}))}(e.scheme,e.identifier,n)}))}n&&(i+=" ".concat(n));var c,u=t.slice(0,3).map((function(e){return o.createElement("span",{className:i,key:e.person_or_org.name},function(e){var t=a()(e,"person_or_org.name","No name");return o.createElement("a",{className:"creatibutor-link",href:'/search?q=metadata.creators.person_or_org.name:"'.concat(t,'"'),title:"".concat(t,": ").concat(s.M.t("Search"))},o.createElement("span",{className:"creatibutor-name"},t))}(e),l(e))})),d=t.length-3;0<d&&(c=1===d?"and {{count}} other":"and {{count}} others",u.push(o.createElement("span",{className:i,key:c},o.createElement("a",{className:"creatibutor-link",href:r},o.createElement("span",{className:"creatibutor-name"},s.M.t(c,{count:d}))))));return u}var c=function(e){return i.DateTime.fromISO(e).setLocale(s.M.language).toRelative()}},69521:(e,t,n)=>{n.d(t,{rt:()=>o.r,Lr:()=>a.L,BK:()=>r.B});var r=n(88860),a=n(21252),o=n(60996)}}]);
//# sourceMappingURL=9300.4f9a5586a957a5004257.js.map